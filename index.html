<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Growth Tribe - A platform for personal growth and community.">
    <title>GROWTH Tribe Platform</title>
    
    <!-- PWA Manifest & Meta -->
    <meta name="theme-color" content="#b425aa">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#b425aa', 
                        secondary: '#c80ec9',
                        accent: '#d4af37',
                        success: '#10b981',
                        error: '#ef4444',
                        background: '#f9fafb',
                    },
                    fontFamily: {
                         sans: ['Poppins', 'sans-serif'],
                         condensed: ['Roboto Condensed', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #f9fafb;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        #root {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .max-w-md.mx-auto {
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.05);
        }
        .safe-pb {
            padding-bottom: max(env(safe-area-inset-bottom), 16px);
        }
        .custom-spinner {
            border-top-color: #d4af37;
            border-left-color: #d4af37;
            border-bottom-color: #b425aa;
            border-right-color: #b425aa;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Supabase Initialization -->
    <script>
        const SUPABASE_URL = 'https://kjffnjcswakrmoqumbzn.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtqZmZuamNzd2Frcm1vcXVtYnpuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3NTU0NjksImV4cCI6MjA3OTMzMTQ2OX0.5fG3qJU3bLpXos94C1mGEJ7TueeK2pKh0Ov9f91fVp8';
        
        window.supabaseClient = null;
        window.isSupabaseConfigValid = true;

        try {
            if (window.supabase) {
                window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log("Supabase client initialized.");
            } else {
                console.error("Supabase library not loaded.");
                window.isSupabaseConfigValid = false;
            }
        } catch (error) {
            console.error("Supabase client creation failed:", error);
            window.isSupabaseConfigValid = false;
        }
    </script>

    <!-- Main Application Logic -->
    <script type="text/babel">
        const LOGO_URL = "https://appimize.app/assets/apps/user_1097/images/2d5cb5dadead_225_1097.png";

        const React = window.React;
        const ReactDOM = window.ReactDOM;
        const { useState, useEffect, useCallback, useMemo } = React;
        const supabase = window.supabaseClient;

        const formatDate = (dateString) => {
          if (!dateString) return 'Just now';
          const date = new Date(dateString);
          return date.toLocaleDateString(undefined, { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        };
        
        const getTodayDateString = () => new Date().toISOString().split('T')[0];
        const getDefaultAvatar = (seed) => `https://api.dicebear.com/7.x/avataaars/svg?seed=${seed}`;

        // --- Lucide Icons ---
        const Heart = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>;
        const MessageCircle = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>;
        const User = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const Home = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const Wallet = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M21 12V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h15"/><path d="M16 12h-4c-1.1 0-2 .9-2 2v2c0 1.1.9 2 2 2h4c1.1 0 2-.9 2-2v-2c0-1.1-.9-2-2-2Z"/></svg>;
        const Award = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="m15.4 11.5 1.4-1.4a2 2 0 0 1 0 2.8l-1.4 1.4"/><path d="m8.6 11.5-1.4-1.4a2 2 0 0 1 0 2.8l1.4 1.4"/><circle cx="12" cy="8" r="6"/><path d="m10 16 2 2 2-2"/></svg>;
        const Sparkles = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M9.9 10.9v1.2M13.5 10.9v1.2M12 8.4v1.2M12 13.5v1.2M17.5 7.5l-1.2 1.2M6.5 14.5l1.2 1.2M18.7 13.5l-1.2-1.2M5.3 8.7l1.2-1.2M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"/></svg>;
        const Bot = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M12 19V5"/><path d="M8 9a2 2 0 0 1-2 2h-1a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h1a2 2 0 0 1 2 2z"/><path d="M16 9a2 2 0 0 0 2 2h1a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-1a2 2 0 0 0-2 2z"/><path d="M2 19h20"/><path d="M12 19v2"/></svg>;
        const X = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M18 6 6 18M6 6l12 12"/></svg>;
        const Leaf = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M11 20A7 7 0 0 1 9.88 6.3l-5-5c-.7-.7-1.4 0-1.4 0s.7.7 0 1.4l5 5A7 7 0 0 1 11 20z"/><path d="M16 4h2l-2 2"/><path d="M19 7h3l-3 3"/><path d="M19 13 h3 l-3-3"/></svg>;
        const TrendingUp = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><polyline points="22 7 13.5 15.5 10.5 12.5 5 18"/><path d="M18 7h4v4"/></svg>;
        const Sun = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>;
        const PiggyBank = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M19 5H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h13"/><path d="M21 7v10a2 2 0 0 1-2 2h-1"/><path d="M6 14h2"/><path d="M12 14h2"/><path d="M10 5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1z"/></svg>;
        const Gift = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M20 12v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-6"/><path d="M12 2v4"/><path d="M19 12H5"/><path d="M17 6c0-1.1-1-2-2-2s-2 1-2 2c0 1.1 1 2 2 2s2-1 2-2zM7 6c0-1.1 1-2 2-2s2 1 2 2c0 1.1-1 2-2 2s-2-1-2-2z"/></svg>;
        const CalendarCheck = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="m9 16 2 2 4-4"/></svg>;
        const Settings = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.44a2 2 0 0 0-2 2h-.44a2 2 0 0 0-2 2v.44a2 2 0 0 0 2 2h.44a2 2 0 0 0 2 2v.44a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.44a2 2 0 0 0-2-2h-.44a2 2 0 0 0-2-2v-.44a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const LogIn = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>;
        const Plus = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const Lock = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const Mail = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>;
        const Save = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
        const LogOut = ({ size = 24, ...p }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>;

        const BADGES = [
          { name: 'Seedling', threshold: 0, icon: <Leaf size={16} />, description: 'Just started your journey!'},
          { name: 'Sprout', threshold: 100, icon: <TrendingUp size={16} />, description: 'Consistency is key. You are making progress.'},
          { name: 'Bloom', threshold: 500, icon: <Sun size={16} />, description: 'Flowering into your potential. Keep shining!'},
          { name: 'Thrive', threshold: 1500, icon: <Heart size={16} fill="currentColor" />, description: 'You are thriving and inspiring others.'},
          { name: 'Master', threshold: 5000, icon: <Award size={16} />, description: 'Achieved harmony and mastery in your ecosystem.'},
        ];

        // --- Modals (stubbed) ---
        const AiCoachModal = ({ onClose }) => (
          <div className="fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4" onClick={onClose}>
            <div className="bg-white rounded-2xl p-6 w-full max-w-md" onClick={e => e.stopPropagation()}>
              <div className="flex justify-between items-center mb-4">
                <h3 className="font-bold">Growth Coach</h3>
                <button onClick={onClose}><X size={20} /></button>
              </div>
              <p className="text-gray-600">Your AI coach is ready to guide you. (Implementation pending)</p>
            </div>
          </div>
        );

        const CreatePostModal = ({ onClose, dailyBonus }) => (
          <div className="fixed inset-0 z-50 bg-black/70 flex items-center justify-center p-4" onClick={onClose}>
            <div className="bg-white rounded-2xl p-6 w-full max-w-md" onClick={e => e.stopPropagation()}>
              <div className="flex justify-between items-center mb-4">
                <h3 className="font-bold">New Post</h3>
                <button onClick={onClose}><X size={20} /></button>
              </div>
              <textarea className="w-full p-3 border rounded-xl mb-4" placeholder="Share your growth moment..."></textarea>
              {dailyBonus && (
                <div className="flex items-center gap-2 text-green-600 text-sm mb-4">
                  <Gift size={16} /> +100 Points for today's first post!
                </div>
              )}
              <button className="w-full bg-primary text-white py-2 rounded-xl">Post</button>
            </div>
          </div>
        );

        // --- Auth Component ---
        const AuthScreen = ({ onAuthSuccess }) => {
            const [isSignUp, setIsSignUp] = useState(false);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [name, setName] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const handleAuth = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError(null);
                try {
                    let result;
                    if (isSignUp) {
                        result = await supabase.auth.signUp({
                            email,
                            password,
                            options: { data: { full_name: name } }
                        });
                    } else {
                        result = await supabase.auth.signInWithPassword({ email, password });
                    }
                    if (result.error) throw result.error;
                    if (result.data.user) onAuthSuccess(result.data.user);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-white fade-in">
                    <div className="w-full max-w-sm text-center">
                        <img src={LOGO_URL} alt="Logo" className="w-20 h-20 mx-auto rounded-full border-4 border-accent mb-6 shadow-lg" />
                        <h1 className="text-3xl font-bold text-primary mb-2">GROWTH Tribe</h1>
                        <p className="text-gray-500 mb-8 italic text-sm leading-relaxed">
                            "Welcome back to your journey from an <strong className="text-primary">ego-system</strong> to an <strong className="text-success">eco-system</strong> — embracing growth, resilience, overall well-being, transformation, and harmony."
                        </p>

                        {error && (
                            <div className="bg-red-50 text-error p-3 rounded-lg text-sm mb-4 border border-red-100 flex items-start text-left">
                                <span className="mr-2">⚠️</span> {error}
                            </div>
                        )}

                        <form onSubmit={handleAuth} className="space-y-4">
                            {isSignUp && (
                                <div className="relative">
                                    <User className="absolute left-3 top-3.5 text-gray-400" size={20} />
                                    <input 
                                        type="text" 
                                        placeholder="Display Name" 
                                        className="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                                        value={name}
                                        onChange={(e) => setName(e.target.value)}
                                        required={isSignUp}
                                    />
                                </div>
                            )}
                            <div className="relative">
                                <Mail className="absolute left-3 top-3.5 text-gray-400" size={20} />
                                <input 
                                    type="email" 
                                    placeholder="Email Address" 
                                    className="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="relative">
                                <Lock className="absolute left-3 top-3.5 text-gray-400" size={20} />
                                <input 
                                    type="password" 
                                    placeholder="Password" 
                                    className="w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                    minLength={6}
                                />
                            </div>

                            <button 
                                type="submit" 
                                disabled={loading}
                                className="w-full bg-primary text-white font-bold py-3.5 rounded-xl shadow-lg shadow-primary/20 hover:bg-primary/90 active:scale-95 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                {loading ? 'Processing...' : (isSignUp ? 'Join the Tribe' : 'Sign In')}
                            </button>
                        </form>

                        <button 
                            onClick={() => setIsSignUp(!isSignUp)}
                            className="mt-6 text-sm text-gray-500 hover:text-primary transition-colors underline decoration-dotted"
                        >
                            {isSignUp ? 'Already have an account? Sign In' : 'New here? Create an account'}
                        </button>
                    </div>
                </div>
            );
        };

        // --- Settings Component ---
        const SettingsView = ({ userProfile, onUpdateProfile, onSignOut }) => {
            const [formData, setFormData] = useState({
                displayName: userProfile.displayName || '',
                bio: userProfile.bio || '',
                avatarUrl: userProfile.avatarUrl || ''
            });
            const [isSaving, setIsSaving] = useState(false);
            const [message, setMessage] = useState(null);
            const [dirty, setDirty] = useState(false);

            const handleChange = (e) => {
                setDirty(true);
                setFormData({ ...formData, [e.target.name]: e.target.value });
            };

            const validateUrl = (str) => {
                if (!str) return true;
                try { return !!new URL(str); } catch { return false; }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!formData.displayName.trim()) {
                    setMessage({ type: 'error', text: 'Display Name cannot be empty.' });
                    return;
                }
                if (formData.avatarUrl && !validateUrl(formData.avatarUrl)) {
                    setMessage({ type: 'error', text: 'Please enter a valid image URL.' });
                    return;
                }

                setIsSaving(true);
                setMessage(null);
                await onUpdateProfile(formData);
                setMessage({ type: 'success', text: 'Profile updated successfully!' });
                setIsSaving(false);
                setTimeout(() => setMessage(null), 3000);
            };

            return (
                <div className="p-4 pt-8 pb-24 fade-in">
                    <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                        <Settings className="text-primary" /> Profile Settings
                    </h2>

                    <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">
                        <div className="flex items-center gap-4 mb-6">
                            <img 
                                src={formData.avatarUrl || getDefaultAvatar(userProfile.user_id)} 
                                alt="Avatar Preview" 
                                className="w-16 h-16 rounded-full border-2 border-accent object-cover"
                            />
                            <div>
                                <p className="text-sm font-semibold text-gray-900">Avatar Preview</p>
                                <p className="text-xs text-gray-500">Based on your avatar URL</p>
                            </div>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-xs font-bold text-gray-500 uppercase mb-1" htmlFor="displayName">Display Name</label>
                                <input
                                    id="displayName"
                                    name="displayName"
                                    type="text"
                                    value={formData.displayName}
                                    onChange={handleChange}
                                    className="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary outline-none transition-all"
                                    placeholder="Your Name"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-xs font-bold text-gray-500 uppercase mb-1" htmlFor="bio">Bio</label>
                                <textarea
                                    id="bio"
                                    name="bio"
                                    rows="3"
                                    value={formData.bio}
                                    onChange={handleChange}
                                    className="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary outline-none transition-all resize-none"
                                    placeholder="Tell us about your growth journey..."
                                />
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-gray-500 uppercase mb-1" htmlFor="avatarUrl">Avatar URL</label>
                                <input
                                    id="avatarUrl"
                                    name="avatarUrl"
                                    type="url"
                                    value={formData.avatarUrl}
                                    onChange={handleChange}
                                    onBlur={(e) => {
                                        if (e.target.value && !validateUrl(e.target.value)) {
                                            setMessage({ type: 'error', text: 'Please enter a valid image URL.' });
                                        }
                                    }}
                                    className="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary outline-none transition-all"
                                    placeholder="https://example.com/my-image.png"
                                />
                            </div>

                            {message && (
                                <div className={`p-3 rounded-lg text-sm ${message.type === 'error' ? 'bg-red-50 text-red-600' : 'bg-green-50 text-green-600'}`}>
                                    {message.text}
                                </div>
                            )}

                            <button 
                                type="submit" 
                                disabled={isSaving || !dirty}
                                className="w-full bg-primary text-white font-bold py-3 rounded-xl shadow-md hover:bg-primary/90 flex items-center justify-center gap-2 disabled:opacity-50"
                            >
                                {isSaving ? 'Saving...' : <><Save size={18} /> Save Changes</>}
                            </button>
                        </form>
                    </div>

                    <button 
                        onClick={onSignOut}
                        className="w-full bg-red-50 text-red-600 font-bold py-3 rounded-xl hover:bg-red-100 transition-colors flex items-center justify-center gap-2 border border-red-100"
                    >
                        <LogOut size={18} /> Sign Out
                    </button>
                </div>
            );
        };

        // --- Nav Button ---
        const NavBtn = ({ icon, label, active, onClick }) => (
            <button
                onClick={onClick}
                className={`flex flex-col items-center gap-1 text-xs ${active ? 'text-primary font-bold' : 'text-gray-500'}`}
            >
                {icon}
                <span>{label}</span>
            </button>
        );

        // --- Header ---
        const Header = ({ userProfile }) => (
            <header className="fixed top-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-md z-40 border-b border-gray-200 px-6 py-4">
                <div className="flex items-center justify-between">
                    <h1 className="text-xl font-bold text-primary">GROWTH Tribe</h1>
                    <div className="flex items-center gap-2">
                        <span className="text-sm font-bold text-primary">{userProfile.points || 0}</span>
                        <PiggyBank size={20} className="text-primary" />
                    </div>
                </div>
            </header>
        );

        // --- Main App ---
        const App = () => {
            const [session, setSession] = useState(null);
            const [userProfile, setUserProfile] = useState(null);
            const [activeTab, setActiveTab] = useState('home');
            const [loading, setLoading] = useState(true);
            const [showCreatePost, setShowCreatePost] = useState(false);
            const [showAiCoach, setShowAiCoach] = useState(false);

            useEffect(() => {
                if (!supabase) return;
                supabase.auth.getSession().then(({ data: { session } }) => {
                    setSession(session);
                    setLoading(false);
                });
                const { data: { subscription } } = supabase.auth.onAuthStateChange((_, session) => {
                    setSession(session);
                    setLoading(false);
                });
                return () => subscription.unsubscribe();
            }, []);

            useEffect(() => {
                if (!session?.user) return;
                const fetchProfile = async () => {
                    const { data, error } = await supabase
                        .from('profiles')
                        .select('*')
                        .eq('user_id', session.user.id)
                        .single();
                    if (data) {
                        setUserProfile(data);
                    } else {
                        const newProfile = {
                            user_id: session.user.id,
                            displayName: session.user.user_metadata.full_name || 'New Member',
                            points: 100,
                            avatarUrl: getDefaultAvatar(session.user.id),
                            last_post_date: new Date(Date.now() - 86400000).toISOString().split('T')[0],
                            bio: 'Ready to grow!'
                        };
                        const { data: created } = await supabase.from('profiles').insert([newProfile]).select().single();
                        if (created) setUserProfile(created);
                    }
                };
                fetchProfile();
            }, [session]);

            const handleUpdateProfile = async (updates) => {
                if (!userProfile) return;
                await supabase.from('profiles').update(updates).eq('user_id', userProfile.user_id);
                setUserProfile({ ...userProfile, ...updates });
            };

            const handleSignOut = async () => {
                await supabase.auth.signOut();
                setSession(null);
                setUserProfile(null);
                setActiveTab('home');
            };

            const isDailyBonusAvailable = useMemo(() => {
                if (!userProfile) return false;
                const today = getTodayDateString();
                return userProfile.last_post_date !== today;
            }, [userProfile]);

            if (!window.isSupabaseConfigValid) {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen text-center p-6 bg-red-50 text-red-800">
                        <X size={48} className="mb-4" />
                        <h1 className="text-xl font-bold">Configuration Error</h1>
                        <p>Supabase keys are missing. Check index.html source code.</p>
                    </div>
                );
            }

            if (loading) {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-gray-50">
                        <div className="w-12 h-12 border-4 custom-spinner rounded-full animate-spin mb-4"></div>
                        <p className="text-sm font-medium text-gray-500">Loading Ecosystem...</p>
                    </div>
                );
            }

            if (!session) {
                return <AuthScreen onAuthSuccess={(user) => setSession({ user })} />;
            }

            if (!userProfile) {
                return (
                    <div className="flex flex-col items-center justify-center min-h-screen bg-gray-50">
                        <div className="w-12 h-12 border-4 custom-spinner rounded-full animate-spin mb-4"></div>
                        <p className="text-sm font-medium text-gray-500">Initializing Profile...</p>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-24 bg-gray-50">
                    <Header userProfile={userProfile} />
                    
                    <main className="max-w-md mx-auto pt-20 px-4 fade-in">
                        {activeTab === 'home' && (
                            <div className="space-y-6">
                                <div className="bg-gradient-to-r from-primary to-secondary rounded-2xl p-5 text-white shadow-lg relative overflow-hidden">
                                    <div className="relative z-10">
                                        <h2 className="font-bold text-lg mb-1">Growth Coach</h2>
                                        <p className="text-white/90 text-sm mb-3">Your AI guide for personal transformation.</p>
                                        <button 
                                            onClick={() => setShowAiCoach(true)}
                                            className="bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/40 rounded-lg px-4 py-2 text-xs font-bold flex items-center gap-2 transition-all"
                                        >
                                            <Sparkles size={14} className="text-accent" />
                                            Start Session
                                        </button>
                                    </div>
                                    <div className="absolute right-0 bottom-0 opacity-10 transform translate-x-4 translate-y-4">
                                        <Bot size={120} />
                                    </div>
                                </div>

                                <div className="flex justify-between items-center">
                                    <h2 className="text-xl font-bold text-gray-900">Community Feed</h2>
                                    <button 
                                        onClick={() => setShowCreatePost(true)}
                                        className="text-primary hover:underline text-sm font-medium"
                                    >
                                        + New Post
                                    </button>
                                </div>
                                
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 text-center">
                                    <Sparkles className="mx-auto text-primary mb-3" size={32} />
                                    <p className="text-gray-500">No posts yet. Be the first to share your growth!</p>
                                </div>
                            </div>
                        )}

                        {activeTab === 'wallet' && (
                            <div className="p-4 pt-8 pb-24 fade-in">
                                <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                                    <Wallet className="text-primary" /> My Wallet
                                </h2>
                                <div className="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <p className="text-gray-500">Total Points</p>
                                        <div className="flex items-center gap-2">
                                            <PiggyBank className="text-accent" size={20} />
                                            <span className="text-2xl font-bold text-primary">{userProfile.points || 0}</span>
                                        </div>
                                    </div>
                                    <div className={`p-4 rounded-xl ${isDailyBonusAvailable ? 'bg-green-50 border border-green-100' : 'bg-gray-50 border border-gray-200'}`}>
                                        <div className="flex items-center gap-2 text-sm">
                                            <Gift size={18} />
                                            <span className={isDailyBonusAvailable ? 'text-green-700 font-medium' : 'text-gray-500'}>
                                                Daily Bonus: {isDailyBonusAvailable ? 'Available!' : 'Already claimed today'}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'badges' && (
                            <div className="p-4 pt-8 pb-24 fade-in">
                                <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                                    <Award className="text-primary" /> Your Badges
                                </h2>
                                <div className="space-y-4">
                                    {BADGES.map((badge, idx) => {
                                        const next = BADGES[idx + 1];
                                        const earned = userProfile.points >= badge.threshold;
                                        const progress = next 
                                            ? Math.min(100, Math.max(0, ((userProfile.points - badge.threshold) / (next.threshold - badge.threshold)) * 100))
                                            : 100;

                                        return (
                                            <div key={badge.name} className={`p-4 rounded-2xl border ${earned ? 'bg-gradient-to-r from-primary/10 to-secondary/10 border-primary/30' : 'bg-gray-50 border-gray-200'}`}>
                                                <div className="flex items-start gap-3">
                                                    <div className={`p-2 rounded-lg ${earned ? 'bg-primary text-white' : 'bg-gray-200 text-gray-500'}`}>
                                                        {badge.icon}
                                                    </div>
                                                    <div className="flex-1">
                                                        <h3 className="font-bold">{badge.name}</h3>
                                                        <p className="text-sm text-gray-600">{badge.description}</p>
                                                        {next && earned && (
                                                            <div className="mt-2">
                                                                <div className="w-full bg-gray-200 rounded-full h-2">
                                                                    <div className="bg-accent h-2 rounded-full" style={{ width: `${progress}%` }}></div>
                                                                </div>
                                                                <p className="text-xs text-gray-500 mt-1">
                                                                    {userProfile.points} / {next.threshold} to next badge
                                                                </p>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {activeTab === 'settings' && (
                            <SettingsView 
                                userProfile={userProfile} 
                                onUpdateProfile={handleUpdateProfile}
                                onSignOut={handleSignOut}
                            />
                        )}
                    </main>

                    <div className="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-md border-t border-gray-200 px-6 py-3 flex justify-between items-center z-50 safe-pb shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                        <NavBtn icon={<Home size={24} />} label="Hub" active={activeTab === 'home'} onClick={() => setActiveTab('home')} />
                        <NavBtn icon={<Wallet size={24} />} label="Wallet" active={activeTab === 'wallet'} onClick={() => setActiveTab('wallet')} />
                        <button 
                            onClick={() => setShowCreatePost(true)}
                            className="relative -top-6 bg-primary text-white p-4 rounded-full shadow-xl shadow-primary/30 border-4 border-gray-50 transition-transform active:scale-95 hover:scale-105"
                            aria-label="Create Post"
                        >
                            <Plus size={28} />
                        </button>
                        <NavBtn icon={<Award size={24} />} label="Badges" active={activeTab === 'badges'} onClick={() => setActiveTab('badges')} />
                        <NavBtn icon={<User size={24} />} label="Profile" active={activeTab === 'profile' || activeTab === 'settings'} onClick={() => setActiveTab('settings')} />
                    </div>

                    {showAiCoach && <AiCoachModal onClose={() => setShowAiCoach(false)} />}
                    {showCreatePost && <CreatePostModal onClose={() => setShowCreatePost(false)} dailyBonus={isDailyBonusAvailable} />}
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>

